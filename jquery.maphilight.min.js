(function(e){var t,n,r,s,o,u,a,f,l,c,h;n=!!document.createElement("canvas").getContext;var p=function(e,t){return e.highlighted?e.highlightedOpacity:e[t+"Opacity"]};t=function(){var e=document.createElement("div");e.innerHTML='<v:shape id="vml_flag1" adj="1" />';var t=e.firstChild;return t.style.behavior="url(#default#VML)",t?typeof t.adj=="object":!0}();if(!n&&!t){e.fn.maphilight=function(){return this};return}if(n){f=function(e){return Math.max(0,Math.min(parseInt(e,16),255))},l=function(e,t){return"rgba("+f(e.substr(0,2))+","+f(e.substr(2,2))+","+f(e.substr(4,2))+","+t+")"},r=function(t){var n=e('<canvas style="width:'+t.width+"px;height:"+t.height+'px;"></canvas>').get(0);return n.getContext("2d").clearRect(0,0,n.width,n.height),n};var d=function(e,t,n,r,s){r=r||0,s=s||0,e.beginPath();if(t=="rect")e.rect(n[0]+r,n[1]+s,n[2]-n[0],n[3]-n[1]);else if(t=="poly"){e.moveTo(n[0]+r,n[1]+s);for(i=2;i<n.length;i+=2)e.lineTo(n[i]+r,n[i+1]+s)}else t=="circ"&&e.arc(n[0]+r,n[1]+s,n[2],0,Math.PI*2,!1);e.closePath()};s=function(t,n,r,i,s){var o,u=t.getContext("2d");if(i.shadow){u.save(),i.shadowPosition=="inside"&&(d(u,n,r),u.clip());var a=t.width*100,f=t.height*100;d(u,n,r,a,f),u.shadowOffsetX=i.shadowX-a,u.shadowOffsetY=i.shadowY-f,u.shadowBlur=i.shadowRadius,u.shadowColor=l(i.shadowColor,i.shadowOpacity);var c=i.shadowFrom;c||(i.shadowPosition=="outside"?c="fill":c="stroke"),c=="stroke"?(u.strokeStyle="rgba(0,0,0,1)",u.stroke()):c=="fill"&&(u.fillStyle="rgba(0,0,0,1)",u.fill()),u.restore(),i.shadowPosition=="outside"&&(u.save(),d(u,n,r),u.globalCompositeOperation="destination-out",u.fillStyle="rgba(0,0,0,1);",u.fill(),u.restore())}u.save(),d(u,n,r),i.fill&&(u.fillStyle=l(i.fillColor,p(i,"fill")),u.fill()),i.stroke&&(u.strokeStyle=l(i.strokeColor,p(i,"stroke")),u.lineWidth=i.strokeWidth,u.stroke()),u.restore(),i.fade&&e(t).css("opacity",0).animate({opacity:1},100)},o=function(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}}else r=function(t){return e('<var style="zoom:1;overflow:hidden;display:block;width:'+t.width+"px;height:"+t.height+'px;"></var>').get(0)},s=function(t,n,r,i,s){var o,u,a,f;o='<v:fill color="#'+i.fillColor+'" opacity="'+(i.fill?i.fillOpacity:0)+'" />',u=i.stroke?'strokeweight="'+i.strokeWidth+'" stroked="t" strokecolor="#'+i.strokeColor+'"':'stroked="f"',a='<v:stroke opacity="'+i.strokeOpacity+'"/>',n=="rect"?f=e('<v:rect name="'+s+'" filled="t" '+u+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+r[0]+"px;top:"+r[1]+"px;width:"+(r[2]-r[0])+"px;height:"+(r[3]-r[1])+'px;"></v:rect>'):n=="poly"?f=e('<v:shape name="'+s+'" filled="t" '+u+' coordorigin="0,0" coordsize="'+t.width+","+t.height+'" path="m '+r[0]+","+r[1]+" l "+r.join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+t.width+"px;height:"+t.height+'px;"></v:shape>'):n=="circ"&&(f=e('<v:oval name="'+s+'" filled="t" '+u+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(r[0]-r[2])+"px;top:"+(r[1]-r[2])+"px;width:"+r[2]*2+"px;height:"+r[2]*2+'px;"></v:oval>')),f.get(0).innerHTML=o+a,e(t).append(f)},o=function(t){e(t).find("[name=highlighted]").remove()};u=function(e){var t,n=e.getAttribute("coords").split(",");for(t=0;t<n.length;t++)n[t]=parseFloat(n[t]);return[e.getAttribute("shape").toLowerCase().substr(0,4),n]},h=function(t,n){var r=e(t);return e.extend({},n,e.metadata?r.metadata():!1,r.data("maphilight"))},c=function(e){return e.complete?typeof e.naturalWidth!="undefined"&&e.naturalWidth===0?!1:!0:!1},a={position:"absolute",left:0,top:0,padding:0,border:0};var v=!1;e.fn.maphilight=function(i){i=e.extend({},e.fn.maphilight.defaults,i);if(t&&!v){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var f=document.createStyleSheet(),l=["shape","rect","oval","circ","fill","stroke","imagedata","group","textbox"];e.each(l,function(){f.addRule("v\\:"+this,"behavior: url(#default#VML); antialias:true")}),v=!0}return this.each(function(){var f,l,p,d,v,m,g,y,b;f=e(this);if(!c(this))return window.setTimeout(function(){f.maphilight(i)},200);p=e.extend({},i,e.metadata?f.metadata():!1,f.data("maphilight")),b=f.get(0).getAttribute("usemap");if(!b)return;d=e('map[name="'+b.substr(1)+'"]');if(!(f.is('img,input[type="image"]')&&b&&d.size()>0))return;if(f.hasClass("maphilighted")){var w=f.parent();f.insertBefore(w),w.remove(),e(d).unbind(".maphilight").find("area[coords]").unbind(".maphilight")}l=e("<div></div>").css({display:"block",background:'url("'+this.src+'")',position:"relative",padding:0,width:this.width,height:this.height}),p.wrapClass&&(p.wrapClass===!0?l.addClass(e(this).attr("class")):l.addClass(p.wrapClass)),f.before(l).css("opacity",0).css(a).remove(),t&&f.css("filter","Alpha(opacity=0)"),l.append(f),v=r(this),e(v).css(a),v.height=this.height,v.width=this.width,g=function(t){var r,i;i=h(this,p);if(!i.neverOn&&!i.alwaysOn){r=u(this),s(v,r[0],r[1],i,"highlighted");if(i.groupBy){var o;/^[a-zA-Z][\-a-zA-Z]+$/.test(i.groupBy)?o=d.find("area["+i.groupBy+'="'+e(this).attr(i.groupBy)+'"]'):o=d.find(i.groupBy);var a=this;o.each(function(){if(this!=a){var e=h(this,p);if(!e.neverOn&&!e.alwaysOn){var t=u(this);s(v,t[0],t[1],e,"highlighted")}}})}n||e(v).append("<v:rect></v:rect>")}},e(d).bind("alwaysOn.maphilight",function(){m&&o(m),n||e(v).empty(),e(d).find("area[coords]").each(function(){var t,i;i=h(this,p);if(i.alwaysOn||i.highlighted)!m&&n&&(m=r(f[0]),e(m).css(a),m.width=f[0].width,m.height=f[0].height,f.before(m)),i.fade=i.alwaysOnFade,t=u(this),n?s(m,t[0],t[1],i,""):s(v,t[0],t[1],i,"")})}),e(d).trigger("alwaysOn.maphilight").find("area[coords]").bind("mouseover.maphilight",g).bind("mouseout.maphilight",function(e){o(v)}),f.before(v),f.addClass("maphilighted")})},e.fn.maphilight.defaults={fill:!0,fillColor:"000000",fillOpacity:.2,stroke:!0,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,fade:!0,alwaysOn:!1,neverOn:!1,groupBy:!1,wrapClass:!0,shadow:!1,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"000000",shadowOpacity:.8,shadowPosition:"outside",shadowFrom:!1}})(jQuery);